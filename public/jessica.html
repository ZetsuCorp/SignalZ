<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jessica Auto Feed</title>
  <link rel="stylesheet" href="jessica.css" />
</head>
<body>
  <h1>ü§ñ Jessica‚Äôs Feed</h1>
  <div class="jessica-feed" id="feed"></div>

  <script>
    const API_KEY = 'AIzaSyBqlCCuh41JXepJP1YRv2XJcdNfyp0WsqI';
    const CX = 'b3aed2fbcf2074d6a';

    const queries = [
      { platform: "Twitter", query: "new on twitter" },
      { platform: "X", query: "latest X posts" },
      { platform: "Reddit", query: "breaking reddit news" },
      { platform: "TikTok", query: "viral TikToks July 17" },
    ];

    const feed = document.getElementById('feed');
    const DEFAULT_IMG = 'https://via.placeholder.com/600x300/00f0ff/000?text=Jessica+AI';
    const FALLBACK_RIPPLE = 'https://via.placeholder.com/48/00f0ff/000?text=‚óè';

    const intros = [
      "‚Äî Ever wondered what‚Äôs buzzing on",
      "‚Äî Hot off the wire from",
      "‚Äî The latest scoop from",
      "‚Äî Here's what‚Äôs lighting up",
      "‚Äî Jessica on scene at"
    ];

    const outros = [
      "‚Äî Find out here",
      "‚Äî Tap in for the full story",
      "‚Äî Get the details",
      "‚Äî Full report below",
      "‚Äî Read more"
    ];

    function extractDomain(link) {
      try {
        return new URL(link).hostname.replace("www.", "");
      } catch {
        return "unknown";
      }
    }

    function renderIframeOrFallback(url, fallbackHTML) {
      const wrapper = document.createElement('div');
      wrapper.style.marginTop = '1rem';

      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.style.width = '100%';
      iframe.style.height = '300px';
      iframe.style.border = '1px solid #00f0ff55';
      iframe.style.borderRadius = '12px';

      let loaded = false;

      iframe.onload = () => {
        loaded = true;
      };

      setTimeout(() => {
        if (!loaded) {
          wrapper.innerHTML = fallbackHTML;
        }
      }, 1200);

      wrapper.appendChild(iframe);
      return wrapper;
    }

    async function fetchAndRender({ platform, query }) {
      const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(query)}&gl=US&hl=en`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        const posts = (data.items || []).filter(item =>
          item.link &&
          item.snippet && item.snippet.length > 30 &&
          !item.link.includes("feed/trending") &&
          !item.link.includes("explore")
        );

        const timestamp = new Date().toLocaleString();
        const intro = `${intros[Math.floor(Math.random() * intros.length)]} ${platform}`;
        const outro = `${outros[Math.floor(Math.random() * outros.length)]}`;

        posts.forEach(item => {
          const card = document.createElement('div');
          card.className = 'jessica-post';

          const fallbackHTML = `
            <a href="${item.link}" target="_blank" style="
              display: block;
              background: #0f0f0f;
              color: white;
              padding: 1rem;
              border: 1px solid #00f0ff44;
              border-radius: 12px;
              text-decoration: none;
              margin-top: 0.5rem;
            ">
              <strong>${item.title || "Visit Link"}</strong><br />
              <small>${extractDomain(item.link)}</small>
            </a>
          `;

          card.innerHTML = `
            <div class="jessica-meta-header" style="display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
              <div class="sigz-icon-stack" style="position: relative; width: 48px; height: 48px;">
                <span style="
                  position: absolute;
                  top: 50%; left: 50%;
                  transform: translate(-50%, -50%);
                  font-size: 2rem;
                  z-index: 0;
                ">üåê</span>
                <img
                  src="/sigicons/ripple.gif"
                  alt="Ripple"
                  onerror="this.onerror=null; this.src='${FALLBACK_RIPPLE}'"
                  style="
                    position: absolute;
                    top: 50%; left: 50%;
                    width: 48px; height: 48px;
                    transform: translate(-50%, -50%);
                    z-index: 10;
                    pointer-events: none;
                  "
                />
              </div>
              <span class="jessica-id" style="font-weight: bold; font-size: 0.85rem; color: #00f0ff;">
                Jessica reporting from ‚Äî <span class="jessica-platform-label">${platform}</span>
              </span>
            </div>

            <div class="jessica-img">
              <img src="${DEFAULT_IMG}" alt="Preview" onerror="this.onerror=null; this.src='${DEFAULT_IMG}'" />
            </div>

            <div class="jessica-meta">
              <span class="jessica-platform">${platform}</span>
              <p class="jessica-intro">${intro}</p>
              <p class="jessica-caption">"${item.snippet}"</p>
              <span class="jessica-date">${timestamp}</span>
              <p class="jessica-outro">${outro}</p>
            </div>
          `;

          const previewBlock = renderIframeOrFallback(item.link, fallbackHTML);
          card.appendChild(previewBlock);
          feed.appendChild(card);
        });
      } catch (err) {
        console.warn(`Jessica failed on ${platform}:`, err);
      }
    }

    queries.forEach(fetchAndRender);
  </script>
</body>
</html>
